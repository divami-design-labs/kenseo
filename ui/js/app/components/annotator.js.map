{"version":3,"sources":["components/annotator.js"],"names":[],"mappings":"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","file":"components/annotator.js","sourcesContent":["// Things to consider:\r\n// - PDFJS renders the pdf page wise. It doesn't render whole pdf at once. It renders only the pages which are nearer to view.\r\nvar annotator = (function(){\r\n\tvar $previousCommentSection = null;\r\n\tvar insertComment = function(payload){\r\n\t\t// Sometimes the current wrapper's jquery element is provided or we need to extract from passed event variable 'e'\r\n\t\tvar $el = payload.$el || $(payload.e.currentTarget);\r\n\t\tvar data = payload.data;\r\n        var $commentContainer = $(document.createElement('div'));\r\n        $commentContainer.addClass('comment-container');\r\n        // Adding the comment section template (should be done before applying styles to move the section)\r\n        $commentContainer.append(sb.setTemplate('comment', {data: data || {'newComment': true}}));\r\n        if(payload.isNewComment){\r\n\t\t\t// Deleting the previous comment section which wasn't saved\r\n\t\t\tif($previousCommentSection){\r\n\t\t\t\t// If the previous comment section isn't saved then remove it\r\n\t\t\t\tif(!$previousCommentSection.hasClass('isSaved')){\r\n\t\t\t\t\t$previousCommentSection.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n        \tvar e = payload.e;\r\n        \tvar posx = ($el.scrollLeft() + e.pageX - $el.offset().left)/($el.outerWidth())  * 100;\r\n        \tvar posy = ($el.scrollTop()  + e.pageY - $el.offset().top )/($el.outerHeight()) * 100;\r\n        \t$commentContainer.css({\r\n\t\t\t\tleft: posx + \"%\",\r\n\t\t\t\ttop:  posy + \"%\"\r\n\t\t\t});\r\n\t\t\t// Bring the new comment to front\r\n\t\t\tbringCommentToFront($commentContainer);\r\n\t\t\t// Adding a dummy comment id to newly added comment for further manipulations\r\n\t\t\t$commentContainer.attr('data-k-comment_thread_id', \"-1\");\r\n\r\n\t\t\t// get current page number\r\n\t\t\tvar $currentPage = $el.parents('.page');\r\n\t\t\tvar currentPageIndex = $currentPage.index() + 1;\r\n\t\t\tconsole.log(currentPageIndex);\r\n\t\t\t// Add this new comments data inside the stored data\r\n\t\t\tvar currentVersionId = getCurrentVersionId($el);\r\n\t\t\tvar data = sb.getCurrentDocumentData(currentVersionId);\r\n\t\t\tsb.setCurrentThreadData(currentVersionId, '-1',  {\r\n\t\t\t\tposx: posx,\r\n\t\t\t\tposy: posy,\r\n\t\t\t\tpage_no: currentPageIndex,\r\n\t\t\t\t// making flag dontHide as true. So that when page is rendered, the comment section should not hide surprisingly\r\n\t\t\t\tdontHide: true\r\n\t\t\t});\r\n\t\t\t// Kenseo.document[]\r\n\t\t    \r\n\t\t    // attach page_no\r\n\t\t    $commentContainer.attr('data-k-page_no', currentPageIndex);\r\n\t\t    $commentContainer.attr('data-k-posx', posx);\r\n\t\t    $commentContainer.attr('data-k-posy', posy);\r\n        }\r\n        else{\r\n        \t// Existing comment manipulations\r\n        \t$commentContainer.attr('data-k-comment_thread_id', payload['thread_id']);\r\n\t        $commentContainer.css({\r\n\t            left: data.posx + \"%\",\r\n\t            top:  data.posy + \"%\",\r\n\t        });\r\n            \t// Keeping the comment section hidden if the flag \"dontHide\" is false\r\n            \tif(!data.dontHide){\r\n\t            $commentContainer.children('.shape').addClass('hide-comment-section');\r\n\t        }\r\n\r\n\t        // Add \"isSaved\" class as a flag to the comment section\r\n\t        // This flag will be used to identify whether the comment section is saved or not\r\n\t        $commentContainer.addClass('isSaved');\r\n\r\n\t        // Kenseo.document[]\r\n\r\n\t        // attach page_no\r\n\t\t    $commentContainer.attr('data-k-page_no', data.page_no);\r\n\t\t    $commentContainer.attr('data-k-posx', data.posx);\r\n\t\t    $commentContainer.attr('data-k-posy', data.posy);\r\n\t    }\r\n\t    // attach version id\r\n\t    $commentContainer.attr('data-k-artefact_ver_id', payload['version_id']);\r\n\t    // set flag to say that the content of this comment\r\n\t    $commentContainer.addClass('isStoredLocally');\r\n        // $commentContainer.append($shape);\r\n        $el.append($commentContainer);\r\n\r\n        // After inserting the comment on the document, the current comment section will become previous comment section\r\n        $previousCommentSection = $commentContainer;\r\n    }\r\n    var insertCommentWrapper = function(currentArtefactId, data){\r\n        var $pdfDocContainer = getDocContainer(currentArtefactId);\r\n        if(!$pdfDocContainer.length){\r\n        \tsb.log(\"pdfDocContainer is missing\");\r\n        \treturn;\r\n        }\r\n        var $textLayers = $pdfDocContainer.find('.page');\r\n        if(!$textLayers.length){\r\n        \tsb.log(\"textLayers are missing\");\r\n        \treturn;\r\n    \t}\r\n    \tif(!data){\r\n    \t\t// Artefact has no data\r\n    \t\tsb.log(\"artefact has no data\");\r\n    \t\treturn;\r\n    \t}\r\n        for(var key in data){\r\n        \tvar d = data[key];\r\n        \tvar $el = $textLayers.eq(+d.page_no-1).find('.new-textlayer');\r\n            if($el.length){\r\n                insertComment({\r\n                \t\"$el\": $el, \r\n                \t\"data\": d,\r\n                \t\"thread_id\": key,\r\n                \t\"version_id\": currentArtefactId\r\n                });\r\n            }\r\n        }\r\n    }\r\n    var getDocContainer = function(id){\r\n    \tvar elemString = \"[rel='pdf_\" + id + \"']\";\r\n        return $(elemString);\r\n    }\r\n    var getCurrentVersionId = function($el){\r\n\t\tvar rel = $el.parents('.outerContainer').attr('rel');\r\n\t\t// removing prefix \"pdf_\" from found rel attribute\r\n\t\treturn rel.substr(4);\r\n    }\r\n    var bringCommentToFront = function($currentCommentContainer){\r\n    \t$('.comment-container').css({'z-index': ''});\r\n\t\t$currentCommentContainer.css({'z-index': '2'});\r\n    }\r\n    var commentValidations = function($el){\r\n    \tvar $commentSection = $el.parents('.comment-container');\r\n    \tvar $postBtn = $commentSection.find('.main-btn');\r\n    \tvar $textBox = $commentSection.find('.write-comment');\r\n\r\n    \tvar artefactVersionId = $commentSection.attr('data-k-artefact_ver_id');\r\n    \tvar threadId = $commentSection.attr('data-k-comment_thread_id');\r\n\r\n    \tvar originalData = Kenseo.document[artefactVersionId][threadId];\r\n    \tvar gatheredData = sb.getCommentThreadDumpObject($commentSection);\r\n\r\n    \tif(commentSectionIsChanged(originalData, gatheredData) || $.trim($textBox.val()).length){\r\n    \t\t$postBtn.removeAttr('disabled');\r\n    \t}\r\n    \telse{\r\n    \t\t$postBtn.attr('disabled', 'true');\t\r\n    \t}\r\n    }\r\n    var commentSectionIsChanged = function(originalData, gatheredData){\r\n    \tvar checkers = ['severity', 'category', 'state', 'is_private'];\r\n    \tfor(var i = 0, len = checkers.length; i < len; i++){\r\n    \t\tif(originalData[checkers[i]] !== gatheredData[checkers[i]]){\r\n    \t\t\treturn true;\r\n    \t\t}\r\n    \t}\r\n    \treturn false;\r\n    }\r\n\treturn {\r\n\t\tinit: function(){\r\n\t\t\t$(document).on('click', '.new-textlayer', this.annotate);\r\n\t\t\t$(document).on('click', '.drpdwn-item', function(){\r\n\t\t\t\tvar $self = $(this);\r\n\t\t\t\tvar $selectedText = $self.parents('.drpdwn').find('.drpdwn-selected-text');\r\n\t\t\t\tvar value = $self.attr('data-value');\r\n\t\t\t\tif($selectedText.length){\r\n\t\t\t\t\t// normal dropdown functionality\r\n\t\t\t\t\t$selectedText.html($self.text());\r\n\r\n\t\t\t\t\tvar $dropdown = $self.parents('.drpdwn');\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t// severity check dropdown functionality\r\n\t\t\t\t\tvar colorCode = $self.data('value');\r\n\t\t\t\t\t// var $shape = $self.parents('.comment-container').find('.shape');\r\n\t\t\t\t\t// $shape.attr('data-k-color', colorCode);\r\n\t\t\t\t\tvar $dropdown = $self.parents('.drpdwn').prev();\r\n\t\t\t\t}\r\n\t\t\t\tvar dataType = $dropdown.attr('data-type');\r\n\t\t\t\t$dropdown.attr('data-k-' + dataType, value);\r\n\t\t\t\tcommentValidations($self);\r\n\t\t\t});\r\n\t\t\t$(document).on('click', '.comment-section .cancel-btn', function(){\r\n\t\t\t\tvar $commentContainer = $(this).parents('.comment-container');\r\n\t\t\t\tif($commentContainer.hasClass('isSaved')){\r\n\t\t\t\t\t// if the comment is already saved, then just hide it\r\n\t\t\t\t\t$commentContainer.children('.shape').addClass('hide-comment-section');\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tvar versionId = $commentContainer.attr('data-k-version');;\r\n\t\t\t\t\tvar threadId = $commentContainer.attr('data-k-thread');\r\n\t\t\t\t\t// Remove the comment container completely if the comment is not yet saved\r\n\t\t\t\t\t$commentContainer.remove();\r\n\t\t\t\t\t// Remove also from local object\r\n\t\t\t\t\tsb.setCurrentThreadData(versionId, threadId, null);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$(document).on('click', '.shape', function(e){\r\n\t\t\t\tvar $self = $(this);\r\n\t\t\t\tvar $commentContainer = $self.parents('.comment-container');\r\n\t\t\t\tvar versionId = $commentContainer.attr('data-k-artefact_ver_id');\r\n\t\t\t\tvar threadId = $commentContainer.attr('data-k-comment_thread_id');\r\n\t\t\t\tvar threadData = Kenseo.document[versionId][threadId];\r\n\t\t\t\tthreadData.dontHide = $self.hasClass('hide-comment-section');\r\n\t\t\t\t$self.toggleClass('hide-comment-section');\r\n\t\t\t});\r\n\r\n\t\t\t// private message checkbox event\r\n\t\t\t$(document).on('change', '.private-chk', function(e){\r\n\t\t\t\tvar $self = $(this);\r\n\t\t\t\tif(this.checked){\r\n\t\t\t\t\t$self.attr('data-k-is_private','1');\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t$self.attr('data-k-is_private','0');\t\r\n\t\t\t\t}\r\n\t\t\t\t// Do validations\r\n\t\t\t\tcommentValidations($self);\r\n\t\t\t});\r\n\r\n\t\t\t$(document).on('click', '.comment-container .main-btn', function(e){\r\n\t\t\t\tvar $self = $(this);\r\n\t\t\t\tvar $commentSection = $self.parents('.comment-container');\r\n\t\t\t\tvar versionId = $commentSection.attr('data-k-artefact_ver_id');\r\n\t\t\t\tvar threadId = $commentSection.attr('data-k-comment_thread_id');\r\n\r\n\t\t\t\tsb.ajaxCall({\r\n\t\t\t\t\turl: sb.getRelativePath('createComment'),\r\n\t\t\t\t\tdata: sb.getCommentThreadDumpObject($commentSection),\r\n\t\t\t\t\texcludeDump: true,\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\tplainData: true,\r\n\t\t\t\t\t//contentType: 'application/json',\r\n\t\t\t\t\t//dataType: 'json',\r\n\t\t\t\t\tsuccess: function(response){\r\n\t\t\t\t\t\tvar data = response.data || {};\r\n\t\t\t\t\t\tvar params = response.params;\r\n\t\t\t\t\t\t// new comment thread id and old comment thread id will differ when the comment is being saved for the first time\r\n\t\t\t\t\t\tvar newCommentThreadId = Object.keys(data)[0];\r\n\t\t\t\t\t\tvar oldCommentThreadId = params.comment_thread_id;\r\n\t\t\t\t\t\tsb.setCurrentThreadData(params.artefact_ver_id, newCommentThreadId, data[newCommentThreadId]);\r\n\r\n\t\t\t\t\t\t// re-render the thread section\r\n\t\t\t\t\t\t// Deleting the old comment thread id section\r\n\t\t\t\t\t\tvar $pdfDocContainer = getDocContainer(params.artefact_ver_id);\r\n\t\t\t\t\t\tvar $commentSection = $('[data-k-comment_thread_id=\"' + oldCommentThreadId + '\"].comment-container');\r\n\t\t\t\t\t\t$commentSection.hide();\r\n\r\n\t\t\t\t\t\t// Dont hide flag\r\n\t\t\t\t\t\tdata[newCommentThreadId].dontHide = false;\r\n\t\t\t\t\t\tinsertCommentWrapper(params.artefact_ver_id, data);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t\t// write comment event attachment\r\n\t\t\t// - Temporary fix: The main aim of this function is to run validation on whether to enable the post button or not\r\n\t\t\t// - Currently, there is already a function which does this i.e commentValidations\r\n\t\t\t// - In future, when edit and delete functionality is included, improve this function or try to make it similar to other change events.\r\n\t\t\t$(document).on('keyup', '.write-comment', function(){\r\n\t\t\t\tvar $self = $(this);\r\n\t\t\t\tvar value = this.value;\r\n\t\t\t\tvar $currentCommentSection = $self.parents('.comment-container');\r\n \t\t\t\tvar $postBtn = $currentCommentSection.find('.main-btn');\r\n\t\t\t\t\r\n\t\t\t\tif($.trim(value).length){\r\n\t\t\t\t\t$postBtn.removeAttr('disabled');\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tcommentValidations($self);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\r\n\t\t},\r\n\t\tannotate: function(e){\r\n\t\t\tvar $target = $(e.target);\r\n\t\t\tif(sb.hasInheritClass($target, ['comment-container', 'current-artefact-info'])){\r\n\t\t\t\t// bringToFront();\r\n\t\t\t\tvar $currentCommentContainer = $target.hasClass('comment-container')? $target: $target.parents('.comment-container');\r\n\t\t\t\tbringCommentToFront($currentCommentContainer);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar $el = $(e.currentTarget);\r\n\t\t\tinsertComment({\r\n\t\t\t\t\"e\": e,\r\n\t\t\t\t\"isNewComment\": true,\r\n\t\t\t\t\"version_id\": getCurrentVersionId($el)\r\n\t\t\t});\r\n\t\t},\r\n\t\tpaintExistingAnnotations: function(currentContainerVersionID){\r\n\t\t\t// Removing all the already painted comment sections\r\n\t\t\t$('.comment-container.isStoredLocally').remove();\r\n\t\t\t// Get the current container\r\n\t\t\t// -- For now, assume the current container as \"158\"\r\n\t\t\t// var currentContainerVersionID = 3;\r\n\t\t\tvar currentVersionIdData = sb.getCurrentDocumentData(currentContainerVersionID);\r\n\t\t\tif(currentVersionIdData && currentVersionIdData.noChangesDetected){\r\n\t\t\t\t// if data is present and not changed, don't call for ajax.. use the existing data\r\n\t\t\t\tinsertCommentWrapper(currentContainerVersionID, currentVersionIdData);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t        // get the calling url from paintPdf function\r\n\t\t\t\tsb.ajaxCall({\r\n\t\t\t\t\turl: sb.getRelativePath('getArtefactDetails'),\r\n\t\t\t\t\t// flag to say not to store the response data in Kenseo.data global variable\r\n\t\t\t\t\texcludeDump: true,\r\n\t\t\t\t\tdata: {\r\n                        artefactVersionId: Kenseo.data.artefact.id,\r\n                        withVersions: true,\r\n                        withComments: true\r\n                    },\r\n\t\t\t\t\tsuccess: function(response){\r\n\t\t\t\t\t\tvar data = response.data;\r\n\t\t\t\t\t\t// Store the current artefact version related data in a global variable\r\n                        var threads = data.threads;\r\n                        // flag\r\n                        threads.noChangesDetected = true;\r\n                        sb.setCurrentDocumentData(data.artefactId, threads);\r\n\r\n\r\n\t\t\t\t\t\tinsertCommentWrapper(currentArtefactId, data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// -- end of ajax call\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n})();\r\n"],"sourceRoot":"/source/"}